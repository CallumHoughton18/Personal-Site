<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/Personal-Site/styles.43dc7ea2b8359cc862ec.css" data-identity="gatsby-global-css">/*! tailwindcss v2.2.7 | MIT License | https://tailwindcss.com */

/*! modern-normalize v1.1.0 | MIT License | https://github.com/sindresorhus/modern-normalize */html{-webkit-text-size-adjust:100%;line-height:1.15;-moz-tab-size:4;-o-tab-size:4;tab-size:4}body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji;margin:0}hr{color:inherit;height:0}abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace,SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{border-color:inherit;text-indent:0}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,select{text-transform:none}[type=button],button{-webkit-appearance:button}legend{padding:0}progress{vertical-align:baseline}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}button{background-color:transparent;background-image:none}fieldset,ol,ul{margin:0;padding:0}ol,ul{list-style:none}html{font-family:Helvetica,Arial,sans-serif;line-height:1.5}body{font-family:inherit;line-height:inherit}*,:after,:before{border:0 solid;box-sizing:border-box}hr{border-top-width:1px}img{border-style:solid}textarea{resize:vertical}input::-webkit-input-placeholder,textarea::-webkit-input-placeholder{color:#a1a1aa;opacity:1}input:-ms-input-placeholder,textarea:-ms-input-placeholder{color:#a1a1aa;opacity:1}input::placeholder,textarea::placeholder{color:#a1a1aa;opacity:1}button{cursor:pointer}table{border-collapse:collapse}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}button,input,optgroup,select,textarea{color:inherit;line-height:inherit;padding:0}code,kbd,pre,samp{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{height:auto;max-width:100%}*,:after,:before{--tw-border-opacity:1;border-color:rgba(228,228,231,var(--tw-border-opacity))}.container{width:100%}@media (min-width:640px){.container{max-width:640px}}@media (min-width:768px){.container{max-width:768px}}@media (min-width:1024px){.container{max-width:1024px}}@media (min-width:1280px){.container{max-width:1280px}}@media (min-width:1536px){.container{max-width:1536px}}.invisible{visibility:hidden}.static{position:static}.fixed{position:fixed}.absolute{position:absolute}.relative{position:relative}.inset-x-0{left:0;right:0}.top-16{top:4rem}.right-6{right:1.5rem}.z-50{z-index:50}.mx-auto{margin-left:auto;margin-right:auto}.my-4{margin-bottom:1rem;margin-top:1rem}.mt-1{margin-top:.25rem}.mt-4{margin-top:1rem}.mt-5{margin-top:1.25rem}.mt-8{margin-top:2rem}.mt-10{margin-top:2.5rem}.mt-20{margin-top:5rem}.mt-36{margin-top:9rem}.mr-0{margin-right:0}.mr-3{margin-right:.75rem}.mr-4{margin-right:1rem}.mr-5{margin-right:1.25rem}.mr-0\.5{margin-right:.125rem}.mb-1{margin-bottom:.25rem}.mb-2{margin-bottom:.5rem}.mb-3{margin-bottom:.75rem}.mb-5{margin-bottom:1.25rem}.mb-8{margin-bottom:2rem}.mb-10{margin-bottom:2.5rem}.mb-36{margin-bottom:9rem}.ml-0{margin-left:0}.ml-5{margin-left:1.25rem}.ml-0\.5{margin-left:.125rem}.block{display:block}.inline-block{display:inline-block}.inline{display:inline}.flex{display:flex}.table{display:table}.max-h-0{max-height:0}.min-h-full{min-height:100%}.w-overflow{width:102%}.max-w-0{max-width:0}.max-w-xl{max-width:36rem}.max-w-4xl{max-width:56rem}.flex-grow{flex-grow:1}.transform{--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;-webkit-transform:translateX(var(--tw-translate-x)) translateY(var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y));transform:translateX(var(--tw-translate-x)) translateY(var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.scale-75{--tw-scale-x:.75;--tw-scale-y:.75}@-webkit-keyframes spin{to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}@keyframes spin{to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}@-webkit-keyframes ping{75%,to{opacity:0;-webkit-transform:scale(2);transform:scale(2)}}@keyframes ping{75%,to{opacity:0;-webkit-transform:scale(2);transform:scale(2)}}@-webkit-keyframes pulse{50%{opacity:.5}}@keyframes pulse{50%{opacity:.5}}@-webkit-keyframes bounce{0%,to{-webkit-animation-timing-function:cubic-bezier(.8,0,1,1);animation-timing-function:cubic-bezier(.8,0,1,1);-webkit-transform:translateY(-25%);transform:translateY(-25%)}50%{-webkit-animation-timing-function:cubic-bezier(0,0,.2,1);animation-timing-function:cubic-bezier(0,0,.2,1);-webkit-transform:none;transform:none}}@keyframes bounce{0%,to{-webkit-animation-timing-function:cubic-bezier(.8,0,1,1);animation-timing-function:cubic-bezier(.8,0,1,1);-webkit-transform:translateY(-25%);transform:translateY(-25%)}50%{-webkit-animation-timing-function:cubic-bezier(0,0,.2,1);animation-timing-function:cubic-bezier(0,0,.2,1);-webkit-transform:none;transform:none}}@-webkit-keyframes fade-in{0%{opacity:0}to{opacity:1}}@keyframes fade-in{0%{opacity:0}to{opacity:1}}.select-none{-webkit-user-select:none;-ms-user-select:none;user-select:none}.resize{resize:both}.list-none{list-style-type:none}.list-disc{list-style-type:disc}.flex-row{flex-direction:row}.flex-col{flex-direction:column}.flex-wrap{flex-wrap:wrap}.items-start{align-items:flex-start}.items-center{align-items:center}.justify-start{justify-content:flex-start}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.justify-evenly{justify-content:space-evenly}.space-x-5>:not([hidden])~:not([hidden]){--tw-space-x-reverse:0;margin-left:calc(1.25rem*(1 - var(--tw-space-x-reverse)));margin-right:calc(1.25rem*var(--tw-space-x-reverse))}.self-start{align-self:flex-start}.overflow-hidden{overflow:hidden}.whitespace-nowrap{white-space:nowrap}.rounded{border-radius:.25rem}.rounded-lg{border-radius:.5rem}.rounded-full{border-radius:9999px}.rounded-b-sm{border-bottom-left-radius:.125rem;border-bottom-right-radius:.125rem}.border{border-width:1px}.border-b-2{border-bottom-width:2px}.border-none{border-style:none}.border-snowStorm-darkest,.border-snowStorm-lightest{--tw-border-opacity:1;border-color:rgba(236,239,244,var(--tw-border-opacity))}.border-transparent{border-color:transparent}.border-gray-700{--tw-border-opacity:1;border-color:rgba(63,63,70,var(--tw-border-opacity))}.hover\:border-snowStorm:hover{--tw-border-opacity:1;border-color:rgba(229,233,240,var(--tw-border-opacity))}.bg-polarNight{--tw-bg-opacity:1;background-color:rgba(59,66,82,var(--tw-bg-opacity))}.bg-polarNight-lighter{--tw-bg-opacity:1;background-color:rgba(67,76,94,var(--tw-bg-opacity))}.bg-snowStorm{--tw-bg-opacity:1;background-color:rgba(229,233,240,var(--tw-bg-opacity))}.bg-transparent{background-color:transparent}.bg-gray-200{--tw-bg-opacity:1;background-color:rgba(228,228,231,var(--tw-bg-opacity))}.hover\:bg-blueGray-500:hover{--tw-bg-opacity:1;background-color:rgba(100,116,139,var(--tw-bg-opacity))}.bg-opacity-80{--tw-bg-opacity:0.8}.to-polarNight-darkest{--tw-gradient-to:#2e3440}.p-10{padding:2.5rem}.p-20{padding:5rem}.px-2{padding-left:.5rem;padding-right:.5rem}.px-3{padding-left:.75rem;padding-right:.75rem}.px-4{padding-left:1rem;padding-right:1rem}.px-6{padding-left:1.5rem;padding-right:1.5rem}.px-10{padding-left:2.5rem;padding-right:2.5rem}.py-1{padding-bottom:.25rem;padding-top:.25rem}.py-2{padding-bottom:.5rem;padding-top:.5rem}.py-4{padding-bottom:1rem;padding-top:1rem}.py-6{padding-bottom:1.5rem;padding-top:1.5rem}.pt-2{padding-top:.5rem}.pt-12{padding-top:3rem}.pt-20{padding-top:5rem}.pr-5{padding-right:1.25rem}.pb-4{padding-bottom:1rem}.pb-20{padding-bottom:5rem}.pl-5{padding-left:1.25rem}.text-center{text-align:center}.text-xs{font-size:.75rem;line-height:1rem}.text-sm{font-size:.875rem;line-height:1.25rem}.text-base{font-size:1rem;line-height:1.5rem}.text-lg{font-size:1.125rem}.text-lg,.text-xl{line-height:1.75rem}.text-xl{font-size:1.25rem}.text-2xl{font-size:1.5rem;line-height:2rem}.text-4xl{font-size:2.25rem;line-height:2.5rem}.font-light{font-weight:300}.font-semibold{font-weight:600}.font-bold{font-weight:700}.font-extrabold{font-weight:800}.uppercase{text-transform:uppercase}.leading-relaxed{line-height:1.625}.tracking-normal{letter-spacing:0}.tracking-wide{letter-spacing:.025em}.tracking-widest{letter-spacing:.1em}.text-polarNight-lightest{--tw-text-opacity:1;color:rgba(76,86,106,var(--tw-text-opacity))}.text-snowStorm{--tw-text-opacity:1;color:rgba(229,233,240,var(--tw-text-opacity))}.text-snowStorm-lightest{--tw-text-opacity:1;color:rgba(236,239,244,var(--tw-text-opacity))}.text-aurora-green{--tw-text-opacity:1;color:rgba(163,190,140,var(--tw-text-opacity))}.text-gray-400{--tw-text-opacity:1;color:rgba(161,161,170,var(--tw-text-opacity))}.text-gray-700{--tw-text-opacity:1;color:rgba(63,63,70,var(--tw-text-opacity))}.text-blueGray-300{--tw-text-opacity:1;color:rgba(203,213,225,var(--tw-text-opacity))}.text-blueGray-500{--tw-text-opacity:1;color:rgba(100,116,139,var(--tw-text-opacity))}.hover\:text-snowStorm-darkest:hover{--tw-text-opacity:1;color:rgba(236,239,244,var(--tw-text-opacity))}.hover\:text-snowStorm:hover{--tw-text-opacity:1;color:rgba(229,233,240,var(--tw-text-opacity))}.hover\:text-gray-300:hover{--tw-text-opacity:1;color:rgba(212,212,216,var(--tw-text-opacity))}.hover\:text-blueGray-300:hover{--tw-text-opacity:1;color:rgba(203,213,225,var(--tw-text-opacity))}.hover\:text-blueGray-700:hover{--tw-text-opacity:1;color:rgba(51,65,85,var(--tw-text-opacity))}.focus\:text-blueGray-300:focus{--tw-text-opacity:1;color:rgba(203,213,225,var(--tw-text-opacity))}*,:after,:before{--tw-shadow:0 0 #0000}.shadow{--tw-shadow:0 1px 3px 0 rgba(0,0,0,0.1),0 1px 2px 0 rgba(0,0,0,0.06)}.shadow,.shadow-md{box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}.shadow-md{--tw-shadow:0 4px 6px -1px rgba(0,0,0,0.1),0 2px 4px -1px rgba(0,0,0,0.06)}.shadow-inner{--tw-shadow:inset 0 2px 4px 0 rgba(0,0,0,0.06);box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}.focus\:outline-none:focus{outline:2px solid transparent;outline-offset:2px}*,:after,:before{--tw-ring-inset:var(--tw-empty,/*!*/ /*!*/);--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgba(59,130,246,0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000}.ring-4{--tw-ring-offset-shadow:var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow:var(--tw-ring-inset) 0 0 0 calc(4px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow,0 0 #0000)}.ring-white{--tw-ring-opacity:1;--tw-ring-color:rgba(255,255,255,var(--tw-ring-opacity))}.filter{--tw-blur:var(--tw-empty,/*!*/ /*!*/);--tw-brightness:var(--tw-empty,/*!*/ /*!*/);--tw-contrast:var(--tw-empty,/*!*/ /*!*/);--tw-grayscale:var(--tw-empty,/*!*/ /*!*/);--tw-hue-rotate:var(--tw-empty,/*!*/ /*!*/);--tw-invert:var(--tw-empty,/*!*/ /*!*/);--tw-saturate:var(--tw-empty,/*!*/ /*!*/);--tw-sepia:var(--tw-empty,/*!*/ /*!*/);--tw-drop-shadow:var(--tw-empty,/*!*/ /*!*/);-webkit-filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow);filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.drop-shadow-md{--tw-drop-shadow:drop-shadow(0 4px 3px rgba(0,0,0,0.07)) drop-shadow(0 2px 2px rgba(0,0,0,0.06))}.backdrop-blur{--tw-backdrop-blur:blur(8px)}.transition-colors{transition-duration:.15s;transition-property:background-color,border-color,color,fill,stroke;transition-timing-function:cubic-bezier(.4,0,.2,1)}.duration-75{transition-duration:75ms}.ease-linear{transition-timing-function:linear}.backdrop-blur{-webkit-backdrop-filter:blur(3px);backdrop-filter:blur(3px)}.text-shadow-md{text-shadow:0 1px 2px rgb(30 29 39/19%),1px 2px 4px rgb(54 64 147/18%)}.blogpost{--tw-bg-opacity:1;--tw-bg-opacity:0.9;--tw-text-opacity:1;align-items:center;background-color:rgba(59,66,82,var(--tw-bg-opacity));border-radius:.375rem;color:rgba(212,212,216,var(--tw-text-opacity));font-size:.875rem;justify-content:center;line-height:1.25rem;line-height:1.625;margin:1.25rem .5rem;padding:2.5rem 1.25rem}@media (min-width:768px){.blogpost{margin-left:5rem;margin-right:5rem;padding-left:2.5rem;padding-right:2.5rem}}.blogpost small{color:rgba(161,161,170,var(--tw-text-opacity));font-size:.75rem;font-style:italic;line-height:1rem;margin-top:.25rem}.blogpost .title,.blogpost small{--tw-text-opacity:1;align-self:flex-start}.blogpost .title{color:rgba(229,233,240,var(--tw-text-opacity));font-size:1.5rem;font-weight:600;letter-spacing:.025em;line-height:2rem;line-height:1.25;margin-top:1.5rem}@media (min-width:640px){.blogpost .title{font-size:2.25rem;line-height:2.5rem}}@media (min-width:1024px){.blogpost .title{font-size:3rem;line-height:1}}.blogpost .body{margin-top:2rem}@media (min-width:1024px){.blogpost .body{margin-top:3.5rem}}.blogpost h1,.blogpost h2{--tw-text-opacity:1;color:rgba(229,233,240,var(--tw-text-opacity));font-size:1.25rem;font-weight:600;letter-spacing:.025em;line-height:1.75rem;line-height:1.25;margin-bottom:1.5rem;margin-top:1.5rem}@media (min-width:640px){.blogpost h1,.blogpost h2{font-size:1.5rem;line-height:2rem}}.blogpost h3,.blogpost h4,.blogpost h5,.blogpost h6{--tw-text-opacity:1;color:rgba(229,233,240,var(--tw-text-opacity));font-size:1.125rem;font-weight:600;letter-spacing:.025em;line-height:1.75rem;line-height:1.25;margin-bottom:.75rem;margin-top:.75rem}@media (min-width:640px){.blogpost h3,.blogpost h4,.blogpost h5,.blogpost h6{font-size:1.25rem;line-height:1.75rem}}.blogpost p{font-size:.875rem;line-height:1.25rem;margin-bottom:1rem}@media (min-width:640px){.blogpost p{font-size:1rem;line-height:1.5rem}}.blogpost ol,.blogpost ul{list-style-type:disc;margin-bottom:1rem;margin-left:2rem}.blogpost blockquote{--tw-border-opacity:1;--tw-bg-opacity:1;--tw-text-opacity:1;background-color:rgba(236,239,244,var(--tw-bg-opacity));border-color:rgba(161,161,170,var(--tw-border-opacity));border-left-width:4px;color:rgba(59,66,82,var(--tw-text-opacity));font-style:italic;margin-bottom:1rem;margin-left:1.5rem;margin-right:1.5rem;padding:.5rem}.blogpost img{margin-left:auto;margin-right:auto}@media (min-width:1024px){.blogpost img{align-self:flex-start;margin-left:.25rem;margin-right:0}}.blogpost a{--tw-text-opacity:1;color:rgba(129,161,193,var(--tw-text-opacity))}.blogpost a:focus{--tw-text-opacity:1;color:rgba(208,135,112,var(--tw-text-opacity))}.blogpost a:focus,.blogpost a:hover{text-decoration:underline}@media (min-width:640px){.sm\:visible{visibility:visible}.sm\:static{position:static}.sm\:m-8{margin:2rem}.sm\:mt-5{margin-top:1.25rem}.sm\:mb-2{margin-bottom:.5rem}.sm\:ml-auto{margin-left:auto}.sm\:block{display:block}.sm\:h-card{height:33rem}.sm\:max-h-full{max-height:100%}.sm\:max-w-full{max-width:100%}.sm\:flex-50{flex:0 1 50%}.sm\:flex-grow-0{flex-grow:0}.sm\:scale-100{--tw-scale-x:1;--tw-scale-y:1}.sm\:justify-start{justify-content:flex-start}.sm\:text-3xl{font-size:1.875rem;line-height:2.25rem}}@media (min-width:768px){.md\:mt-10{margin-top:2.5rem}.md\:mr-8{margin-right:2rem}.md\:mb-0{margin-bottom:0}.md\:mb-5{margin-bottom:1.25rem}.md\:flex-row{flex-direction:row}.md\:content-center{align-content:center}.md\:border-b-4{border-bottom-width:4px}.md\:p-20{padding:5rem}.md\:text-2xl{font-size:1.5rem;line-height:2rem}.md\:text-4xl{font-size:2.25rem;line-height:2.5rem}.md\:text-7xl{font-size:4.5rem;line-height:1}.md\:tracking-wide{letter-spacing:.025em}}@media (min-width:1024px){.lg\:max-w-6xl{max-width:72rem}}@media (min-width:1280px){.xl\:mr-20{margin-right:5rem}.xl\:ml-20{margin-left:5rem}.xl\:flex-25{flex:0 1 25%}.xl\:text-2xl{font-size:1.5rem;line-height:2rem}}html{background:#717783 url(/Personal-Site/static/background-cbaa96d73dceece65d686550aa0496f7.jpg) no-repeat 50% fixed;background-size:cover}a,button,input,select,textarea{-webkit-tap-highlight-color:rgba(0,0,0,0)}code[class*=language-]{margin-left:0;overflow-x:auto}pre[class*=language-]{word-wrap:normal;background:none;border-radius:.3em;color:#f8f8f2;font-family:Fira Code,Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none;line-height:1.5;margin:.5em 0;overflow:auto;padding:1em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;text-align:left;white-space:pre;word-break:normal;word-spacing:normal}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2e3440}:not(pre)>code[class*=language-]{border-radius:.3em;padding:.1em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#636f88}.token.punctuation{color:#81a1c1}.namespace{opacity:.7}.token.constant,.token.deleted,.token.property,.token.symbol,.token.tag{color:#81a1c1}.token.number{color:#b48ead}.token.boolean{color:#81a1c1}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#a3be8c}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url,.token.variable{color:#81a1c1}.token.atrule,.token.attr-value,.token.class-name,.token.function{color:#88c0d0}.token.keyword{color:#81a1c1}.token.important,.token.regex{color:#ebcb8b}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}</style><meta name="generator" content="Gatsby 3.10.2"/><link rel="alternate" type="application/rss+xml" title="Callum Houghtons Blog Feed" href="/Personal-Site/rss.xml"/><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){if(void 0===e.target.dataset.mainImage)return;if(void 0===e.target.dataset.gatsbyImageSsr)return;const t=e.target;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><link as="script" rel="preload" href="/Personal-Site/webpack-runtime-77c99442c9d461234337.js"/><link as="script" rel="preload" href="/Personal-Site/framework-0c36be73775326e79893.js"/><link as="script" rel="preload" href="/Personal-Site/app-c8e8becf2c863940585a.js"/><link as="script" rel="preload" href="/Personal-Site/component---src-templates-blog-post-tsx-865fe78b7aabc449d181.js"/><link as="fetch" rel="preload" href="/Personal-Site/page-data/blog/digest-auth-in-dotnet/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/Personal-Site/page-data/sq/d/2263501977.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/Personal-Site/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><header class="fixed z-50 inset-x-0"><nav class="flex flex-wrap items-center justify-between px-2 py-2 mb-3 rounded-b-sm transition-colors duration-75 ease-linear text-base bg-transparent"><div class="container px-4 mx-auto flex flex-wrap items-center justify-between"><div class="max-h-0 max-w-0 sm:max-w-full sm:max-h-full relative flex justify-between sm:w-auto sm:static sm:block sm:justify-start"><a class="leading-relaxed inline-block mr-4 py-2 whitespace-no-wrap text-snowStorm-lightest tracking-wide uppercase text font-bold invisible sm:visible">{ Callums.Site }</a></div><div class="flex flex-grow items-center"><ul class="flex flex-grow sm:flex-grow-0 flex-row sm:ml-auto justify-center items-center list-none "><li class=" text-sm text-snowStorm-lightest uppercase tracking-wide font-bold py-2 ml-5 mr-5 hover:text-gray-300 focus:text-blueGray-300 active:text-blueGray-300 select-none"><a class="" href="/Personal-Site/">home</a></li><li class=" text-sm text-snowStorm-lightest uppercase tracking-wide font-bold py-2 ml-5 mr-5 hover:text-gray-300 focus:text-blueGray-300 active:text-blueGray-300 select-none"><a class="" href="/Personal-Site/blog">blog</a></li></ul></div></div></nav></header><main class="flex flex-col pt-12"><article class="blogpost"><span class="title">Implementing Digest Authentication in .NET</span><br/><small>Wed May 04 2022</small><div class="body"><p><strong>UPDATE (03/10/2022): .NET 6 should now successfully do digest authentication, <a href="https://github.com/CallumHoughton18/csharp-dotnet-digest-authentication/issues/1">as kindly pointed by someone in the example repository</a>. Should save you the hassle of doing it manually, like in this blog post!</strong></p>
<p>'The HttpClient class should handle this' I hear you say. Well, unfortunately setting network credentials on a HttpClient instance didn't seem to work for me. <a href="https://stackoverflow.com/questions/62190100/c-sharp-httpclient-digest-authentication-not-work">Multiple</a> <a href="https://stackoverflow.com/questions/59939357/net-core-httpclient-digest-authentication">people</a> <a href="https://stackoverflow.com/questions/65761976/net-5-httpclient-digest-authentication">seem</a> <a href="https://github.com/dotnet/runtime/issues/50283">to</a> be reporting that they also were running into issues. I couldn't find any information as to whether this should be fixed in .NET 6, plus I needed it to be portable to .NET Framework 4.8 (💀💀💀). Either way, I'm going to run through how I implemented digest authentication as an extension method for the HttpClient class.</p>
<p><strong>TL;DR: You can read the code in my GitHub repository <a href="https://github.com/CallumHoughton18/csharp-dotnet-digest-authentication">here</a>, the README provides an example usage. For one request we generate two requests using my method as nothing (nonces, nonce counts) is cached. You can probably cache the header and implement the nonce count properly but that is beyond the scope of what I needed.</strong></p>
<p>This isn't going to implement the full RFC specification for digest authentication. Instead it should be a pretty good starting point for people looking for something that 'just works'.</p>
<p>I'll be using <a href="https://httpbin.org/">Httpbin</a> to simulate the digest authentication workflow.</p>
<h3>Prerequisites</h3>
<ul>
<li>Familiarity with .NET development</li>
<li>Familiarity with HTTP</li>
<li>A fuzzy idea of what digest authentication is and or knowledge of basic authentication</li>
<li>Be frustrated that .NET doesn't do this for you (❗<strong>IMPORTANT</strong>❗)</li>
</ul>
<h3>Digest Authentication - An Overview</h3>
<p><a href="https://en.wikipedia.org/wiki/Digest_access_authentication">Wikipedia already gives a great overview</a> of how digest authentication works. If you want a more in depth explanation you should probably read that. But to follow along all you really need to know is:</p>
<ul>
<li>A request is sent, the server responds with a 401, and the response has a header like:</li>
</ul>
<blockquote>
<p>WWW-Authenticate: Digest realm="<a href="mailto:testrealm@host.com">testrealm@host.com</a>",
qop="auth",
nonce="dcd98b7102dd2f0e8b11d0f600bfb0c093",
opaque="5ccc069c403ebaf9f0171e9517f40e41"</p>
</blockquote>
<ul>
<li>You parse the header and retrieve the realm, qop (quality of protection), nonce, and opaque challenges.</li>
<li>Using a combination of the username, password, and nonces you calculate some new hashes and build up an Authorization header like:</li>
</ul>
<blockquote>
<p>Authorization: Digest username="Mufasa",
realm="<a href="mailto:testrealm@host.com">testrealm@host.com</a>",
nonce="dcd98b7102dd2f0e8b11d0f600bfb0c093",
uri="/dir/index.html",
qop=auth,
nc=00000001,
cnonce="0a4f113b",
response="6629fae49393a05397450978507c4ef1",
opaque="5ccc069c403ebaf9f0171e9517f40e41"</p>
</blockquote>
<ul>
<li>You then resend the request with the given authorization header, which should allow you access to the resource.</li>
</ul>
<p>A couple of things to note here. One being that in my use case I only needed to use MD5 as my hashing algorithm. Digest authentication can also use SHA-256, and this is usually specified in the challenge <code class="language-text">algorithm=SHA-256,</code> in the WWW-Authenticate header. <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/WWW-Authenticate">Though the mdn web docs suggest this isn't really supported and rarely used</a> so for simplicity I haven't accounted for my use case.</p>
<p>The last thing is that the quality of protection (qop) challenge can have more values than just 'auth'. Some examples you may see it like <code class="language-text">qop=auth-int</code> where <code class="language-text">auth-int</code> is authentication with integrity protection. Again, I didn't need to account for this for my use case.</p>
<h3>Interpreting the 401 Error</h3>
<p>Below, you can see the code for wiring up a HttpClient instance to try and get a resource at httpbin:</p>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token class-name"><span class="token keyword">var</span></span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">HttpClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
client<span class="token punctuation">.</span>BaseAddress <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Uri</span><span class="token punctuation">(</span><span class="token string">"https://httpbin.org"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> response <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token function">GetAsync</span><span class="token punctuation">(</span><span class="token string">"/digest-auth/auth/username/password"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>You can see the response code is 401 if you inspect it with a debugger.</p>
<p>Digging further you can see one of the response headers is <code class="language-text">WWW-Authenticate: Digest realm="me@kennethreitz.com", nonce="dd355b0ef0f19b473c6a6609aa288adb", qop="auth", opaque="5a6aa7c0f368ef5c3ae070778fcd54f2", algorithm=MD5, stale=FALSE</code>. This is our first indication that this response is an authentication challenge response, it even gives us the authentication type: <code class="language-text">Digest</code>.</p>
<h3>Parsing the WWW-Authenticate Header</h3>
<p>Using the code below we can parse the WWW-Authenticate header to pull out the values we need to generate an authorization header. Which will be added to our second, authenticated, request.</p>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token class-name"><span class="token keyword">var</span></span> wwwAuthenticateHeaderValue <span class="token operator">=</span> response<span class="token punctuation">.</span>Headers<span class="token punctuation">.</span><span class="token function">GetValues</span><span class="token punctuation">(</span><span class="token string">"WWW-Authenticate"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">FirstOrDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">var</span></span> realm <span class="token operator">=</span> <span class="token function">GrabHeaderVar</span><span class="token punctuation">(</span><span class="token string">"realm"</span><span class="token punctuation">,</span> wwwAuthenticateHeaderValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> nonce <span class="token operator">=</span> <span class="token function">GrabHeaderVar</span><span class="token punctuation">(</span><span class="token string">"nonce"</span><span class="token punctuation">,</span> wwwAuthenticateHeaderValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> qop <span class="token operator">=</span> <span class="token function">GrabHeaderVar</span><span class="token punctuation">(</span><span class="token string">"qop"</span><span class="token punctuation">,</span> wwwAuthenticateHeaderValue<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">var</span></span> clientNonce <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Next</span><span class="token punctuation">(</span><span class="token number">123400</span><span class="token punctuation">,</span> <span class="token number">9999999</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> opaque <span class="token operator">=</span> <span class="token function">GrabHeaderVar</span><span class="token punctuation">(</span><span class="token string">"opaque"</span><span class="token punctuation">,</span> wwwAuthenticateHeaderValue<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">GetChallengeValueFromHeader</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> challengeName<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> fullHeaderValue<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// if variableName = qop, the below regex would look like qop="([^""]*)"</span>
    <span class="token comment">// So it matches anything with the challenge name and then gets the challenge value</span>
    <span class="token class-name"><span class="token keyword">var</span></span> regHeader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Regex</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$@"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">challengeName</span><span class="token punctuation">}</span></span><span class="token string">=""([^""]*)"""</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">var</span></span> matchHeader <span class="token operator">=</span> regHeader<span class="token punctuation">.</span><span class="token function">Match</span><span class="token punctuation">(</span>fullHeaderValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">if</span> <span class="token punctuation">(</span>matchHeader<span class="token punctuation">.</span>Success<span class="token punctuation">)</span> <span class="token keyword">return</span> matchHeader<span class="token punctuation">.</span>Groups<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Value<span class="token punctuation">;</span>
    
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ApplicationException</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"Header </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">challengeName</span><span class="token punctuation">}</span></span><span class="token string"> not found"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>I then opt'd to throw the parsed challenge values into a class just to make it easier to manage. You'll also notice here I'm not doing anything fancy with maintaining the nonce count state. <strong>This is because if the server see's the same nonce count for a previously sent nonce, the response will be a replay</strong>. This was fine for my use case where I was just accessing static content, but it's something to keep in mind. This <em>might</em> lead to servers rejecting a request if they interpret it as a replay attack. That sounds like a problem for another day to me 👉😎👉.</p>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token class-name"><span class="token keyword">var</span></span> digestHeader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DigestAuthHeader</span><span class="token punctuation">(</span>realm<span class="token punctuation">,</span> username<span class="token punctuation">,</span> password<span class="token punctuation">,</span> nonce<span class="token punctuation">,</span> qop<span class="token punctuation">,</span> <span class="token named-parameter punctuation">nonceCount</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> clientNonce<span class="token punctuation">,</span> opaque<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">internal</span> <span class="token keyword">class</span> <span class="token class-name">DigestAuthHeader</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token function">DigestAuthHeader</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> realm<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> username<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> password<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> nonce<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> qualityOfProtection<span class="token punctuation">,</span> 
        <span class="token class-name"><span class="token keyword">int</span></span> nonceCount<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> clientNonce<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> opaque<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Realm <span class="token operator">=</span> realm<span class="token punctuation">;</span>
        Username <span class="token operator">=</span> username<span class="token punctuation">;</span>
        Password <span class="token operator">=</span> password<span class="token punctuation">;</span>
        Nonce <span class="token operator">=</span> nonce<span class="token punctuation">;</span>
        QualityOfProtection <span class="token operator">=</span> qualityOfProtection<span class="token punctuation">;</span>
        NonceCount <span class="token operator">=</span> nonceCount<span class="token punctuation">;</span>
        ClientNonce <span class="token operator">=</span> clientNonce<span class="token punctuation">;</span>
        Opaque <span class="token operator">=</span> opaque<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Realm <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Username <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Password <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Nonce <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> QualityOfProtection <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> NonceCount <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> ClientNonce <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Opaque <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<h3>Generating the Challenge Response Header</h3>
<p>With the challenge values pulled out we can generate the challenge response <code class="language-text">Authorization</code> header value, using the code below:</p>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">GenerateMD5Hash</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> input<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// x2 formatter is for hexadecimal in the ToString function</span>
    <span class="token keyword">using</span> <span class="token class-name">MD5</span> hash <span class="token operator">=</span> MD5<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">Concat</span><span class="token punctuation">(</span>hash<span class="token punctuation">.</span><span class="token function">ComputeHash</span><span class="token punctuation">(</span>Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">.</span><span class="token function">GetBytes</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">)</span>
                                <span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span> x <span class="token operator">=></span> x<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token string">"x2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> 

<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">GetDigestHeader</span><span class="token punctuation">(</span><span class="token class-name">DigestAuthHeader</span> digest<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> digestUri<span class="token punctuation">,</span> <span class="token class-name">HttpMethod</span> method<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> ha1 <span class="token operator">=</span> <span class="token function">GenerateMD5Hash</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">digest<span class="token punctuation">.</span>Username</span><span class="token punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">digest<span class="token punctuation">.</span>Realm</span><span class="token punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">digest<span class="token punctuation">.</span>Password</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">var</span></span> ha2 <span class="token operator">=</span> <span class="token function">GenerateMD5Hash</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">method</span><span class="token punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">digestUri</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">var</span></span> digestResponse <span class="token operator">=</span>
        <span class="token function">GenerateMD5Hash</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">ha1</span><span class="token punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">digest<span class="token punctuation">.</span>Nonce</span><span class="token punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">digest<span class="token punctuation">.</span>NonceCount</span><span class="token format-string"><span class="token punctuation">:</span>00000000</span><span class="token punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">digest<span class="token punctuation">.</span>ClientNonce</span><span class="token punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">digest<span class="token punctuation">.</span>QualityOfProtection</span><span class="token punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">ha2</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name"><span class="token keyword">var</span></span> headerString <span class="token operator">=</span>
        <span class="token interpolation-string"><span class="token string">$"Digest username=\"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">digest<span class="token punctuation">.</span>Username</span><span class="token punctuation">}</span></span><span class="token string">\", realm=\"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">digest<span class="token punctuation">.</span>Realm</span><span class="token punctuation">}</span></span><span class="token string">\", nonce=\"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">digest<span class="token punctuation">.</span>Nonce</span><span class="token punctuation">}</span></span><span class="token string">\", uri=\"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">digestUri</span><span class="token punctuation">}</span></span><span class="token string">\", "</span></span> <span class="token operator">+</span>
        <span class="token interpolation-string"><span class="token string">$"algorithm=MD5, qop=</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">digest<span class="token punctuation">.</span>QualityOfProtection</span><span class="token punctuation">}</span></span><span class="token string">, nc=</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">digest<span class="token punctuation">.</span>NonceCount</span><span class="token format-string"><span class="token punctuation">:</span>00000000</span><span class="token punctuation">}</span></span><span class="token string">, cnonce=\"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">digest<span class="token punctuation">.</span>ClientNonce</span><span class="token punctuation">}</span></span><span class="token string">\", "</span></span> <span class="token operator">+</span>
        <span class="token interpolation-string"><span class="token string">$"response=\"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">digestResponse</span><span class="token punctuation">}</span></span><span class="token string">\", opaque=\"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">digest<span class="token punctuation">.</span>Opaque</span><span class="token punctuation">}</span></span><span class="token string">\""</span></span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> headerString<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Because I'm super lazy, I'll copy and paste the Wikipedia explanation that links to the above code section:</p>
<p>The "response" value is calculated in three steps, as follows. Where values are combined, they are delimited by colons.</p>
<ol>
<li>The MD5 hash of the combined username, authentication realm and password is calculated. The result is referred to as Ha1.</li>
<li>The MD5 hash of the combined method and digest URI is calculated, e.g. of "GET" and "/dir/index.html". The result is referred to as Ha2.</li>
<li>The MD5 hash of the combined HA1 result, server nonce (nonce), request counter (nc), client nonce (cnonce), quality of protection code (qop) and HA2 result is calculated. The result is the "response" value provided by the client.</li>
</ol>
<h3>Extending the HttpClient class</h3>
<p>I decided to wrap all this authentication and re-sending requests in an extension method, which you can see below:</p>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>HttpResponseMessage<span class="token punctuation">></span></span> <span class="token function">SendWithDigestAuthAsync</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token class-name">HttpClient</span> client<span class="token punctuation">,</span> 
    <span class="token class-name">HttpRequestMessage</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpCompletionOption</span> httpCompletionOption<span class="token punctuation">,</span>
    <span class="token class-name"><span class="token keyword">string</span></span> username<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> password<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> newRequest <span class="token operator">=</span> <span class="token function">CloneBeforeContentSet</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">var</span></span> response <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token function">SendAsync</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> httpCompletionOption<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>StatusCode <span class="token operator">!=</span> System<span class="token punctuation">.</span>Net<span class="token punctuation">.</span>HttpStatusCode<span class="token punctuation">.</span>Unauthorized<span class="token punctuation">)</span> <span class="token keyword">return</span> response<span class="token punctuation">;</span>

    <span class="token class-name"><span class="token keyword">var</span></span> wwwAuthenticateHeaderValue <span class="token operator">=</span> response<span class="token punctuation">.</span>Headers<span class="token punctuation">.</span><span class="token function">GetValues</span><span class="token punctuation">(</span><span class="token string">"WWW-Authenticate"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">FirstOrDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name"><span class="token keyword">var</span></span> realm <span class="token operator">=</span> <span class="token function">GetChallengeValueFromHeader</span><span class="token punctuation">(</span><span class="token string">"realm"</span><span class="token punctuation">,</span> wwwAuthenticateHeaderValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">var</span></span> nonce <span class="token operator">=</span> <span class="token function">GetChallengeValueFromHeader</span><span class="token punctuation">(</span><span class="token string">"nonce"</span><span class="token punctuation">,</span> wwwAuthenticateHeaderValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">var</span></span> qop <span class="token operator">=</span> <span class="token function">GetChallengeValueFromHeader</span><span class="token punctuation">(</span><span class="token string">"qop"</span><span class="token punctuation">,</span> wwwAuthenticateHeaderValue<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Must be fresh on every request, so low chance of same client nonce here by just using a random number.</span>
    <span class="token class-name"><span class="token keyword">var</span></span> clientNonce <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Next</span><span class="token punctuation">(</span><span class="token number">123400</span><span class="token punctuation">,</span> <span class="token number">9999999</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">var</span></span> opaque <span class="token operator">=</span> <span class="token function">GetChallengeValueFromHeader</span><span class="token punctuation">(</span><span class="token string">"opaque"</span><span class="token punctuation">,</span> wwwAuthenticateHeaderValue<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name"><span class="token keyword">var</span></span> digestHeader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DigestAuthHeader</span><span class="token punctuation">(</span>realm<span class="token punctuation">,</span> username<span class="token punctuation">,</span> password<span class="token punctuation">,</span> nonce<span class="token punctuation">,</span> qop<span class="token punctuation">,</span> <span class="token named-parameter punctuation">nonceCount</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> clientNonce<span class="token punctuation">,</span> opaque<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">var</span></span> digestRequestHeader <span class="token operator">=</span> <span class="token function">GetDigestHeader</span><span class="token punctuation">(</span>digestHeader<span class="token punctuation">,</span> newRequest<span class="token punctuation">.</span>RequestUri<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span>Method<span class="token punctuation">)</span><span class="token punctuation">;</span>

    newRequest<span class="token punctuation">.</span>Headers<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">"Authorization"</span><span class="token punctuation">,</span> digestRequestHeader<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">var</span></span> authRes <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token function">SendAsync</span><span class="token punctuation">(</span>newRequest<span class="token punctuation">,</span> httpCompletionOption<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> authRes<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token return-type class-name">HttpRequestMessage</span> <span class="token function">CloneBeforeContentSet</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token class-name">HttpRequestMessage</span> req<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Deep clone of a given request, outlined here:</span>
    <span class="token comment">// https://stackoverflow.com/questions/18000583/re-send-httprequestmessage-exception/18014515#18014515</span>
    <span class="token class-name">HttpRequestMessage</span> clone <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">HttpRequestMessage</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>Method<span class="token punctuation">,</span> req<span class="token punctuation">.</span>RequestUri<span class="token punctuation">)</span><span class="token punctuation">;</span>

    clone<span class="token punctuation">.</span>Content <span class="token operator">=</span> req<span class="token punctuation">.</span>Content<span class="token punctuation">;</span>
    clone<span class="token punctuation">.</span>Version <span class="token operator">=</span> req<span class="token punctuation">.</span>Version<span class="token punctuation">;</span>

    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">KeyValuePair<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">object</span><span class="token punctuation">></span></span> prop <span class="token keyword">in</span> req<span class="token punctuation">.</span>Properties<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        clone<span class="token punctuation">.</span>Properties<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>prop<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">KeyValuePair<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> IEnumerable<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">></span><span class="token punctuation">></span></span> header <span class="token keyword">in</span> req<span class="token punctuation">.</span>Headers<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        clone<span class="token punctuation">.</span>Headers<span class="token punctuation">.</span><span class="token function">TryAddWithoutValidation</span><span class="token punctuation">(</span>header<span class="token punctuation">.</span>Key<span class="token punctuation">,</span> header<span class="token punctuation">.</span>Value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> clone<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<h3>The Final Call 🤞</h3>
<p>With all the nasty authentication stuff abstracted away the final function calls should look fairly simple and you're really just substituting one method call:</p>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token class-name"><span class="token keyword">var</span></span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">HttpClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
client<span class="token punctuation">.</span>BaseAddress <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Uri</span><span class="token punctuation">(</span><span class="token string">"https://httpbin.org"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">var</span></span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">HttpRequestMessage</span><span class="token punctuation">(</span>HttpMethod<span class="token punctuation">.</span>Get<span class="token punctuation">,</span> <span class="token string">"/digest-auth/auth/username/password"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
request<span class="token punctuation">.</span>Headers<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">"Accept"</span><span class="token punctuation">,</span> <span class="token string">"*/*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
request<span class="token punctuation">.</span>Headers<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">"User-Agent"</span><span class="token punctuation">,</span> <span class="token string">"HttpClientDigestAuthTester"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
request<span class="token punctuation">.</span>Headers<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">"Accept-Encoding"</span><span class="token punctuation">,</span> <span class="token string">"gzip, deflate, br"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
request<span class="token punctuation">.</span>Headers<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">"Connection"</span><span class="token punctuation">,</span> <span class="token string">"keep-alive"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// This will no respond with a 200 status code</span>
<span class="token class-name"><span class="token keyword">var</span></span> response <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token function">SendWithDigestAuthAsync</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> HttpCompletionOption<span class="token punctuation">.</span>ResponseContentRead<span class="token punctuation">,</span> <span class="token string">"username"</span><span class="token punctuation">,</span> <span class="token string">"password"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// this is what originally gave a 401 status code</span>
<span class="token comment">//var response = await client.GetAsync("/digest-auth/auth/username/password");</span></code></pre></div>
<p>Inspecting the response object should show it now responds with a 200 status code, so we've successfully performed the authentication dance with the server!</p>
<h3>Final Words</h3>
<p>Hopefully someone informs me that there's a simpler more '.NET' way of doing this. Where .NET does most of the heavy lifting for you. If anyone does, be sure to reach out and I'll happily strike through this entire post and point out the better way of doing it.</p>
<p>As I mentioned in a previous section this implementation is far from implementing the full RFC specification for digest authentication, but it should be a decent starting point.</p>
<p>The code for this is on my <a href="https://github.com/CallumHoughton18/csharp-dotnet-digest-authentication">GitHub</a> so feel free to have a look through or make any suggestions.</p></div></article></main></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/digest-auth-in-dotnet/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-156aee4dbdcc4da8dac5.js"],"app":["/app-c8e8becf2c863940585a.js"],"component---src-pages-404-tsx":["/component---src-pages-404-tsx-e8b175a17250793c8553.js"],"component---src-pages-blog-tsx":["/component---src-pages-blog-tsx-84d7dfb03a7e35c22442.js"],"component---src-pages-index-tsx":["/component---src-pages-index-tsx-44bf24e698abd30ab531.js"],"component---src-templates-blog-post-tsx":["/component---src-templates-blog-post-tsx-865fe78b7aabc449d181.js"]};/*]]>*/</script><script src="/Personal-Site/polyfill-156aee4dbdcc4da8dac5.js" nomodule=""></script><script src="/Personal-Site/component---src-templates-blog-post-tsx-865fe78b7aabc449d181.js" async=""></script><script src="/Personal-Site/app-c8e8becf2c863940585a.js" async=""></script><script src="/Personal-Site/framework-0c36be73775326e79893.js" async=""></script><script src="/Personal-Site/webpack-runtime-77c99442c9d461234337.js" async=""></script></body></html>